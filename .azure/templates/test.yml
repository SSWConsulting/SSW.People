steps:
- checkout: none
- download: current

- task: ExtractFiles@1
  inputs:
    archiveFilePatterns: $(Pipeline.Workspace)/drop/*.zip
    destinationFolder: drop

- task: Bash@3
  displayName: 'Deploy to https://sswpeoplestaging.firebaseapp.com/people/'
  inputs:
    targetType: 'inline'
    script: |
      npm install -g firebase-tools
      rm -rf public/previous-employees
      mkdir firebase && mv public firebase/people
      firebase deploy --token $(FIREBASETOKEN)

- task: Bash@3
  displayName: 'Check broken links and performance'
  inputs:
    targetType: 'inline'
    script: 'docker container run --rm --cap-add=SYS_ADMIN sswconsulting/sswlinkauditor --url https://sswpeoplestaging.firebaseapp.com/people/ --lighthouse --token 828ea8af-66c6-4ff5-63c1-9606e3c702d2 --buildId $(Build.BuildNumber)'

