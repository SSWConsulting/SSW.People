steps:
  - checkout: none
  
  - task: DownloadBuildArtifacts@0
    inputs:
      buildType: 'current'
      downloadType: 'single'
      downloadPath: '$(Pipeline.Workspace)'
      artifactName: 'drop'

  - task: ExtractFiles@1
    inputs:
      archiveFilePatterns: $(Pipeline.Workspace)/drop/*.zip
      destinationFolder: public

  - task: PowerShell@2
    displayName: 'Deploy to https://sswpeoplestaging.firebaseapp.com/people/'
    continueOnError: true
    inputs:
      targetType: 'inline'
      script: |
        npm install -g firebase-tools
        mkdir firebase
        mv public firebase/people
        firebase deploy --token $(FIREBASETOKEN)

  - task: PowerShell@2
    displayName: 'SSW CodeAuditor - Check broken links and performance'
    continueOnError: true
    inputs:
      script: |
        docker pull sswconsulting/codeauditor
        docker container run --rm --cap-add=SYS_ADMIN sswconsulting/codeauditor --url https://sswpeoplestaging.firebaseapp.com/people/ --lighthouse --token 828ea8af-66c6-4ff5-63c1-9606e3c702d2 --buildId $(Build.BuildNumber) --debug
